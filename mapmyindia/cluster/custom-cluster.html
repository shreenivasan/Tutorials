<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://apis.mapmyindia.com/advancedmaps/v1/i7xeo4fgj5krcr53aowtx4xcooi5mqeg/map_load?v=0.1"></script>

            <style type="text/css">
                html { 
                    height: 100%; 
                }
                body {
                    height: 100%;
                    font-family:Verdana,sans-serif, Arial;
                    color:#000;
                    margin: 0; 
                    font-size:14px;
                    padding: 0; 
                }
                #map-container {
                    position: absolute;
                    left: 0px; top: 0px; 
                    right: 2px; bottom: 2px; 
                    border: 1px solid #cccccc; }
                #result {
                    position: absolute; 
                    left: 2px; top: 46px;
                    width: 306px;
                    bottom: 2px; 
                    border: 1px solid #cccccc;
                    background-color: #FAFAFA;
                    overflow: auto;
                    font-family:Verdana,sans-serif, Arial;
                }
                .button{
                    width: 220px;
                    font-family:Verdana,sans-serif, Arial;
                    font-size:12px;
                    padding:4px 0;
                    color:#333;
                    border-radius: 5px 5px 5px 5px;
                }
                .btn-div{
                    padding: 12px 12px 6px 38px;
                }
                .top-div{
                    border-bottom: 1px solid #e9e9e9;padding:10px 12px;background:#fff;
                }
                .top-div-span1{
                    font-size: 20px;
                }
                .top-div-span2{
                    font-size:16px;color:#777
                }
            </style>
            <link rel="stylesheet" href="./css/prune.css" />
            <script src="./js/PruneCluster.js"></script>
    </head>
    <body>
        <div>TODO write content</div>
        <div id="map-container"></div>
    </body>
    <script>
            var map = null;
            var mark = [];
            var markers = [];
            var center = new L.LatLng(19.120224, 72.926781);
            var markerCluster = new PruneClusterForLeaflet(); //Create cluster object.
            var size = 3; //set no. of markers in cluster.
            window.onload = function () {
                map = new MapmyIndia.Map('map-container', {
                    zoomControl: true,
                    hybrid: true,
                    zoom: 8,
                    center: center
                });
                drawCluster(); //call drawCluster()
            };
            function drawCluster() {
                clearCluster();
                markerCluster.Cluster.showExactCount = false;  //false will display rounded off marker's count in cluster. true will display exact count. Default true.
                markerCluster.Cluster.Size = 150; //set the area of cluster. Higher number means more markers merged. Default 120. 
                var LatLng = [
                                ["marker1",19.129142,72.928247],
                                ["marker2",19.120224, 72.926781],
                                ["marker3",19.124850, 72.932700]
                            ];
                for (var i = 0; i < size; i++) {
                    var marker = new PruneCluster.Marker(LatLng[i][1] + (Math.random() - 0.5) * Math.random() * 0.00001 * size,
                            LatLng[i][2] + (Math.random() - 0.5) * Math.random() * 0.00002 * size); //create prune cluster marker
                   
            
                            
                    marker.data.idx = i; //set custom data in marker.data object;
                    markers.push(marker); //add marker in custom array
                    markerCluster.RegisterMarker(marker); //Register marker as a member of cluster group.
                }
                //set custom marker icon
                markerCluster.PrepareLeafletMarker = function (marker, data) {
                    marker.setIcon(L.icon({
                        iconUrl: "images/location.png",
                        iconSize: [21, 32]
                    }));
                    //tooltip on mouseover
                    marker.bindTooltip("Marker no. " + data.idx);
                };
                map.addLayer(markerCluster);
                //fit map bound 
                markerCluster.FitBounds();

                //ProcessView function must be called everytime cluster changes/updates.
                markerCluster.ProcessView();
            }
            //handle overlapping markers
            function createSpiderfyCluster() {
                clearCluster();
                markerCluster.Cluster.showExactCount = true;  //false will display rounded off marker's count in cluster. true will display exact count. Default true.
                markerCluster.Cluster.Size = 150; //set the area of cluster. Higher number means more markers merged. Default 120. 
                var request = new XMLHttpRequest();
                request.open("GET", "data/cluster.json", false);
                request.send(null)
                var json = JSON.parse(request.responseText);
                console.log(json.features[0].properties.num)
                for (var a = 0; a < json.features.length; a++) {
                    var x = json.features[a].geometry.coordinates[1];
                    var y = json.features[a].geometry.coordinates[0];
                    if (x > 0 && y > 0) {
                        var marker = new PruneCluster.Marker(y, x, {
                            popup: "Marker no. " + json.features[a].properties.num.toString() //attach popup with marker
                        });
                        markers.push(marker);
                        markerCluster.RegisterMarker(marker);
                    }
                }
                map.addLayer(markerCluster);
                markerCluster.FitBounds();
                markerCluster.ProcessView();
            }
            function clearCluster() {
                if (markers.length > 0) {
                    markerCluster.RemoveMarkers(markers); //remove all markers from cluster
                    markerCluster.ProcessView(); //refresh cluster
                    markers = [];
                    markerCluster = new PruneClusterForLeaflet();
                }
            }
        </script>
</html>
