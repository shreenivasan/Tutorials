<?php

//$fileName = "/var/www/html/app.log";
//$no_lines = 10000;
//$prop_ids = ['A&T0127','A&T0128','A&T0129','A&T0130','A&T0131','A&T0132','A&T0133','A&T0134','A&T0135','A&T0136','A&T0137','A&T0138','A&T0139','A&T0140','A&T0141','A&T0142','A&T0143','A&T0144','A&T0145','A&T0146','A&T0147','A&T0148','A&T0149','A&T0150','A&T0151','A&T0152','A&T0153','A&T0154','A&T0155','A&T0156','A&T0157','A&T0158','A&T0159','A&T0160','A&T0161','A&T0162','A&T0163','A&T0164','A&T0165','A&T0166','A&T0167','A&T0168','A&T0169','A&T0170','A&T0171','A&T0172','A&T0173','A&T0174','A&T0175','A&T0176','A&T0177','A&T0178','A&T0179','A&T0180','A&T0181','A&T0182','A&T0183','A&T0184','A&T0185','A&T0186','A&T0187','A&T0188','A&T0189','A&T0190','A&T0191','A&T0192','A&T0193','A&T0194','A&T0195','A&T0196','A&T0197','A&T0198','A&T0199','A&T0200','A&T0201','A&T0202','A&T0203','A&T0204','A&T0205','A&T0206','A&T0207','A&T0208','A&T0209','A&T0210','A&T0211','A&T0212','A&T0213','A&T0214','A&T0215','A&T0216','A&T0217','A&T0218','A&T0219','A&T0220','A&T0221','A&T0222','A&T0223','A&T0224','A&T0225','A&T0226','A&T0227','A&T0228','A&T0229','A&T0230','A&T0231','A&T0232','East0665','East0666','East0667','East0668','East0669','East0670','East0671','East0672','East0673','East0674','East0675','East0676','East0677','East0678','East0679','East0680','East0681','East0682','East0683','East0684','East0685','East0686','East0687','East0688','East0689','East0690','East0691','East0692','East0693','East0694','East0695','East0696','East0697','East0698','East0699','East0700','East0701','East0702','East0703','East0704','East0705','East0706','East0707','East0708','East0709','East0710','East0711','East0712','East0713','East0714','East0715','East0716','East0717','East0718','East0719','East0720','East0721','East0722','East0723','East0724','East0725','East0726','East0727','East0728','East0729','East0730','East0731','East0732','East0733','East0734','East0735','East0736','East0737','East0738','East0739','East0740','East0741','East0742','East0743','East0744','East0745','East0746','East0747','East0748','East0749','East0750','East0751','East0752','East0753','East0754','East0755','East0756','East0757','East0758','East0759','East0760','East0761','East0762','East0763','East0764','East0765','East0766','East0767','East0768','East0769','East0770','East0771','East0772','East0773','East0774','East0775','East0776','East0777','East0778','East0779','East0780','East0781','East0782','East0783','East0784','East0785','East0786','East0787','East0788','East0789','East0790','East0791','East0792','East0793','East0794','East0795','East0796','East0797','East0798','East0799','East0800','East0801','East0802','East0803','East0804','East0805','East0806','East0807','East0808','East0809','East0810','East0811','East0812','East0813','East0814','East0815','East0816','East0817','East0818','East0819','East0820','East0821','East0822','East0823','East0824','East0825','East0826','East0827','East0828','East0829','East0830','East0831','East0832','East0833','East0834','East0835','East0836','East0837','East0838','East0839','East0840','East0841','East0842','East0843','East0844','East0845','East0846','East0847','East0848','East0849','East0850','East0851','East0852','East0853','East0854','East0855','East0856','East0857','East0858','East0859','East0860','East0861','East0862','East0863','East0864','East0865','East0866','East0867','East0868','East0869','East0870','East0871','East0872','East0873','East0874','East0875','East0876','East0877','East0878','East0879','East0880','East0881','East0882','East0883','East0884','East0885','East0886','East0887','East0888','East0889','East0890','East0891','East0892','East0893','East0894','East0895','East0896','East0897','East0898','East0899','East0900','East0901','East0902','East0903','East0904','East0905','East0906','East0907','East0908','East0909','East0910','East0911','East0912','East0913','East0914','East0915','East0916','East0917','East0918','East0919','East0920','East0921','East0922','East0923','East0924','East0925','East0926','East0927','East0928','East0929','East0930','East0931','East0932','East0933','East0934','East0935','East0936','East0937','East0938','East0939','East0940','East0941','East0942','East0943','East0944','East0945','East0946','East0947','East0948','East0949','East0950','East0951','East0952','East0953','East0954','East0955','East0956','East0957','East0958','East0959','East0960','East0961','East0962','East0963','East0964','East0965','East0966','East0967','East0968','East0969','East0970','East0971','East0974','East0975','East0976','East0977','East0978','East0979','East0980','East0981','East0982','East0983','East0984','East0985','East0986','East0987','East0988','East0989','East0990','East0991','East0994','East0995','East0996','East0997','East0998','East0999','East1000','East1001','East1002','East1003','East1004','East1005','East1006','East1007','East1008','East1009','East1010','East1011','East1012','East1013','East1014','East1015','East1016','East1017','East1018','East1019','East1020','East1021','East1022','East1025','East1026','East1027','East1028','East1029','East1030','East1031','East1032','East1033','East1034','East1035','East1036','East1037','East1038','East1039','East1040','East1041','East1042','East1043','East1044','East1045','East1046','East1047','East1048','East1049','East1050','East1051','East1052','East1053','East1054','East1055','East1056','East1057','East1058','East1059','East1060','East1061','East1062','East1063','East1064','East1065','East1066','East1067','East1068','East1069','East1070','East1071','East1072','East1073','East1074','East1075','East1076','East1077','East1078','East1079','East1080','East1081','East1082','East1083','East1084','East1085','East1086','East1087','East1088','East1089','East1090','East1091','East1092','East1093','East1094','East1095','East1096','East1097','East1098','East1099','East1100','East1101','East1102','East1103','East1104','East1105','East1106','East1107','East1108','East1109','East1110','East1111','East1112','East1113','East1114','East1115','East1116','East1117','East1118','East1119','East1120','East1121','East1122','East1123','East1124','East1125','East1126','East1127','East1128','East1129','East1130','East1131','East1132','East1133','East1134','East1135','NCR0091','NCR0269','NCR0270','NCR0271','NCR0272','NCR0273','NCR0274','NCR0275','NCR0276','NCR0277','NCR0278','NCR0279','NCR0280','NCR0281','NCR0282','NCR0283','NCR0284','NCR0286','NCR0287','NCR0288','NCR0289','NCR0290','NCR0291','NCR0292','NCR0293','NCR0294','NCR0295','NCR0296','NCR0297','NCR0298','NCR0299','NCR0300','NCR0301','NCR0302','NCR0303','NCR0304','NCR0305','NCR0306','NCR0307','NCR0308','NCR0309','NCR0310','NCR0311','NCR0312','NCR0313','NCR0314','NCR0315','NCR0316','NCR0317','NCR0318','NCR0319','NCR0320','NCR0321','NCR0322','NCR0323','NCR0324','NCR0325','NCR0326','NCR0327','NCR0328','NCR0329','NCR0330','NCR0331','NCR0332','NCR0333','NCR0334','NCR0335','NCR0336','NCR0337','NCR0338','NCR0339','NCR0340','NCR0341','NCR0342','NCR0343','NCR0344','NCR0345','NCR0346','NCR0347','NCR0348','NCR0349','NCR0350','NCR0351','NCR0352','NCR0353','NCR0354','NCR0355','NCR0356','NCR0357','NCR0358','NCR0359','NCR0360','NCR0361','NCR0362','NCR0363','NCR0364','NCR0365','NCR0366','NCR0367','NCR0368','NCR0369','NCR0370','NCR0371','NCR0372','NCR0373','NCR0374','NCR0375','NCR0376','NCR0377','NCR0378','NCR0379','NCR0380','NCR0381','NCR0382','NCR0383','NCR0384','NCR0385','NCR0386','NCR0387','NCR0388','NCR0389','NCR0390','NCR0391','NCR0392','NCR0393','NCR0394','NCR0395','NCR0396','NCR0397','NCR0398','NCR0399','NCR0400','NCR0401','NCR0402','NCR0403','NCR0404','NCR0405','NCR0406','NCR0407','NCR0408','NCR0409','NCR0410','NCR0411','NCR0412','NCR0413','NCR0414','NCR0415','NCR0416','NCR0417','NCR0418','NCR0419','NCR0420','NCR0421','NCR0422','NCR0423','NCR0424','NCR0425','NCR0426','NCR0427','NCR0428','NCR0429','NCR0430','NCR0431','NCR0432','NCR0433','NCR0434','NCR0435','NCR0436','NCR0437','NCR0438','NCR0439','NCR0440','NCR0441','NCR0442','NCR0443','NCR0444','NCR0445','NCR0446','NCR0447','NCR0448','NCR0449','NCR0450','NCR0451','NCR0452','NCR0453','NCR0454','NCR0455','NCR0456','NOR0175','NOR0176','NOR0177','NOR0178','NOR0179','NOR0180','NOR0181','NOR0182','NOR0183','NOR0184','NOR0185','NOR0186','NOR0187','NOR0188','NOR0189','NOR0190','NOR0191','NOR0192','NOR0193','NOR0194','NOR0195','NOR0196','NOR0197','NOR0198','NOR0199','NOR0200','NOR0201','NOR0202','NOR0203','NOR0204','NOR0205','NOR0206','NOR0207','NOR0208','NOR0209','NOR0210','NOR0211','NOR0212','NOR0213','NOR0214','NOR0215','NOR0216','NOR0217','NOR0218','NOR0219','NOR0220','NOR0221','NOR0222','NOR0223','NOR0224','NOR0225','NOR0226','NOR0227','NOR0228','NOR0229','NOR0230','NOR0231','NOR0232','NOR0233','NOR0234','NOR0235','NOR0236','NOR0237','NOR0238','NOR0239','NOR0240','NOR0241','NOR0242','NOR0243','NOR0244','NOR0245','NOR0246','NOR0247','NOR0248','NOR0249','NOR0250','NOR0251','NOR0252','NOR0253','NOR0254','NOR0255','NOR0256','NOR0257','NOR0258','NOR0259','NOR0260','NOR0261','NOR0262','NOR0263','NOR0264','NOR0265','NOR0266','NOR0267','NOR0268','NOR0269','NOR0270','NOR0271','NOR0272','NOR0273','NOR0274','NOR0275','NOR0276','NOR0277','NOR0278','NOR0279','NOR0280','NOR0281','NOR0282','NOR0283','NOR0284','NOR0285','NOR0286','NOR0287','NOR0288','NOR0289','NOR0290','NOR0291','NOR0292','NOR0293','NOR0294','NOR0295','NOR0296','NOR0297','NOR0298','NOR0299','NOR0300','NOR0301','NOR0302','NOR0303','NOR0304','NOR0305','NOR0306','NOR0307','NOR0308','NOR0309','NOR0310','NOR0311','NOR0312','NOR0313','NOR0314','NOR0315','NOR0316','NOR0317','NOR0318','NOR0319','NOR0320','NOR0321','NOR0322','NOR0323','NOR0324','NOR0325','NOR0326','NOR0327','NOR0328','NOR0329','NOR0330','NOR0331','NOR0332','NOR0333','NOR0334','NOR0335','NOR0336','NOR0337','NOR0338','NOR0339','NOR0340','NOR0341','NOR0342','NOR0343','NOR0344','NOR0345','NOR0346','NOR0347','NOR0348','NOR0349','NOR0350','NOR0351','NOR0352','NOR0353','NOR0354','NOR0355','NOR0356','NOR0357','NOR0358','NOR0359','NOR0360','NOR0361','NOR0362','NOR0363','NOR0364','NOR0365','NOR0366','NOR0367','NOR0368','NOR0369','NOR0370','NOR0371','NOR0372','NOR0373','NOR0374','NOR0375','NOR0376','NOR0377','NOR0378','NOR0379','NOR0380','NOR0381','NOR0382','NOR0383','NOR0384','NOR0385','NOR0386','NOR0387','NOR0388','NOR0389','NOR0390','NOR0391','NOR0392','NOR0393','NOR0394','NOR0395','NOR0396','NOR0397','NOR0398','NOR0399','NOR0400','NOR0401','NOR0402','NOR0403','NOR0404','NOR0405','NOR0406','NOR0407','NOR0408','NOR0409','NOR0410','NOR0411','NOR0412','NOR0413','NOR0414','NOR0415','NOR0416','NOR0417','NOR0418','NOR0419','NOR0420','NOR0421','NOR0422','NOR0423','NOR0424','NOR0425','NOR0426','NOR0427','NOR0428','NOR0429','NOR0430','NOR0431','NOR0432','NOR0433','NOR0434','NOR0435','NOR0436','NOR0437','NOR0438','NOR0439','NOR0440','NOR0441','NOR0442','NOR0443','NOR0444','NOR0445','NOR0446','NOR0447','NOR0448','NOR0449','NOR0450','NOR0451','NOR0452','NOR0453','NOR0454','NOR0455','NOR0456','NOR0457','NOR0458','NOR0459','NOR0460','NOR0461','NOR0462','NOR0463','NOR0464','NOR0465','NOR0466','NOR0467','NOR0468','NOR0469','NOR0470','NOR0471','NOR0472','NOR0473','NOR0474','NOR0475','NOR0476','NOR0477','NOR0478','NOR0479','NOR0480','NOR0481','NOR0482','NOR0483','NOR0484','NOR0485','NOR0486','NOR0487','NOR0488','SOU0307','SOU0308','SOU0309','SOU0310','SOU0311','SOU0312','SOU0313','SOU0314','SOU0315','SOU0316','SOU0317','SOU0318','SOU0319','SOU0320','SOU0321','SOU0322','SOU0323','SOU0324','SOU0325','SOU0326','SOU0327','SOU0328','SOU0329','SOU0330','SOU0331','SOU0332','SOU0333','SOU0334','SOU0335','SOU0336','SOU0337','SOU0338','SOU0339','SOU0340','SOU0341','SOU0342','SOU0343','SOU0344','SOU0345','SOU0346','SOU0347','SOU0348','SOU0349','SOU0350','SOU0351','SOU0352','SOU0353','SOU0354','SOU0355','SOU0356','SOU0357','SOU0358','SOU0359','SOU0360','SOU0361','SOU0362','SOU0363','SOU0364','SOU0365','SOU0366','SOU0367','SOU0368','SOU0369','SOU0370','SOU0371','SOU0372','SOU0373','SOU0374','SOU0375','SOU0376','SOU0377','SOU0378','SOU0379','SOU0380','SOU0381','SOU0382','SOU0383','SOU0384','SOU0385','SOU0386','SOU0387','SOU0388','SOU0389','SOU0390','SOU0391','SOU0392','SOU0393','SOU0394','SOU0395','SOU0396','SOU0397','SOU0398','SOU0399','SOU0400','SOU0401','SOU0402','SOU0403','SOU0404','SOU0405','SOU0406','SOU0407','SOU0408','SOU0409','SOU0410','SOU0411','SOU0412','SOU0413','SOU0414','SOU0415','SOU0416','SOU0417','SOU0418','SOU0419','SOU0420','SOU0421','SOU0422','SOU0423','SOU0424','SOU0425','SOU0426','SOU0427','SOU0428','SOU0429','SOU0430','SOU0431','SOU0432','SOU0433','SOU0434','SOU0435','SOU0436','SOU0437','SOU0438','SOU0439','SOU0440','SOU0441','SOU0442','SOU0443','SOU0444','SOU0445','SOU0446','SOU0447','SOU0448','SOU0449','SOU0450','SOU0451','SOU0452','SOU0453','SOU0454','SOU0455','SOU0456','SOU0457','SOU0458','SOU0459','SOU0460','SOU0461','SOU0462','SOU0463','SOU0464','SOU0465','West0297','West0298','West0299','West0300','West0301','West0302','West0303','West0304','West0305','West0306','West0307','West0308','West0309','West0310','West0311','West0312','West0313','West0314','West0315','West0316','West0317','West0318','West0319','West0320','West0321','West0322','West0323','West0324','West0325','West0326','West0327','West0328','West0329','West0330','West0331','West0332','West0333','West0334','West0335','West0336','West0337','West0338','West0339','West0340','West0341','West0342','West0343','West0344','West0356','West0357','West0358','West0359','West0360','West0361','West0362','West0363','West0364','West0365','West0366','West0367','West0368','West0369','West0370','West0371','West0372','West0373','West0374','West0375','West0376','West0377','West0378','West0379','West0380','West0381','West0382','West0383','West0384','West0385','West0386','West0387','West0388','West0389','West0390','West0391','West0392','West0393','West0394','West0395','West0396','West0397','West0398','West0399','West0400','West0401','West0402','West0403','West0404','West0405','West0406','West0407','West0408','West0409','West0410','West0411','West0412','West0413','West0414','West0415','West0416','West0417','West0418','West0419','West0420','West0421','West0422','West0423','West0424','West0425','West0426','West0427','West0428','West0429','West0430','West0431','West0432','West0433','West0434','West0435','West0436','West0437','West0438','West0439','West0440','West0441','West0442','West0443','West0444','West0445','West0446','West0447','West0448','West0449','West0450','West0451','West0452','West0453','West0458','West0459','West0460','West0461','West0462','West0463','West0464','West0465','West0466','West0467','West0468','West0469','West0470','West0471','West0472','West0473','West0474','West0475','West0476','West0477','West0478','West0479','West0480','West0481','West0482','West0483','West0484','West0485','West0486','West0487','West0488','West0489','West0490','West0491','West0492','West0493','West0494','West0495','West0496','West0497','West0498','West0499','West0500','West0501','West0502','West0503','West0504','West0505','West0506','West0507','West0508','West0509','West0510','West0511','West0512','West0513','West0514','West0515','West0516','West0517','West0518','West0519','West0520','West0521','West0522','West0523','West0524','West0525','West0526','West0527','West0528','West0529','West0530','West0531','West0532','West0533','West0534','West0535','West0536','West0537','West0538','West0539','West0540','West0541','West0542','West0543','West0544','West0545','West0546','West0547','West0548','West0549','West0550','West0551','West0552','West0553','West0554','West0555','West0556','West0557','West0558','West0559','West0560','West0561','West0562','West0563','West0564','West0565','West0566','West0567','West0568','West0569','West0570','West0571','West0572','West0575','West0583','West0584','West0585','West0586','West0587','West0588','West0589','West0590','West0591','West0592','West0593','West0594','West0595','West0596','West0597','West0598','West0599','West0600','West0601','West0602','West0603','West0604','West0605','West0606','West0607','West0608','West0609','West0610','West0611','West0612','West0613','West0614','West0615','West0616','West0617','West0618','West0619','West0620','West0621','West0622','West0623','West0624','West0625','West0626','West0627','West0628','West0629','West0630','West0631','West0632','West0633','West0634','West0635','West0636','West0637','West0638','West0639','West0640','West0641','West0642','West0643','West0644','West0645','West0646','West0647','West0648','West0649','West0650','West0651','West0652','West0653','West0654','West0655','West0656','West0657','West0658','West0659','West0660','West0661','West0662','West0663'];
//
//$i = 1;
//$data = [];
//
//if ($file = fopen($fileName, "r")) {
//    while(!feof($file)) {
//        $line = fgets($file);  
//        if( strpos( $line, "add_property" )){
//            foreach($prop_ids as $prop){
//                if(strpos($line, $prop) ){
//                    $data[] = $line;
//                }
//            }   
//        }
//        }
//    fclose($file);
//}
//
//file_put_contents('my2.log', implode("\n", array_values($data)), FILE_APPEND);
//die;
$fileName = "/var/www/html/my2.log";
$property_code = ['NCR0091','East1135','NCR0456','NOR0488','SOU0465','SOU0466','NOR0489','NOR0490','East1136','East1137','East1138','NCR0457','East1139','NCR0458','NCR0459','NCR0463','East1143','NCR0464','A&T0233','A&T0234','West0664','SOU0467','SOU0468','NCR0465','A&T0235','A&T0236','A&T0237','A&T0238','A&T0239','A&T0240','A&T0241','A&T0242','NCR0466','A&T0243','A&T0244','A&T0245','A&T0246','A&T0247','A&T0248','A&T0249','SOU0469','East1144','East1145','SOU0470','West0665','SOU0471','A&T0250','A&T0251','SOU0472','SOU0473','A&T0252','A&T0253','A&T0254','SOU0474','East1146','SOU0475','SOU0476','SOU0477','East1147','East1148','East1149','NOR0491','A&T0255','SOU0478','A&T0256','SOU0479','SOU0480','West0666','West0667','West0668','West0669','SOU0481','A&T0257','East1150','A&T0258','East1151','NCR0467','East1152','SOU0482','SOU0483','SOU0484','SOU0485','SOU0486','SOU0487','NOR0492','A&T0259','SOU0488','SOU0489','East1153','East1154','East1155','SOU0490'];
$i = 1;
$data = [];

if ($file = fopen($fileName, "r")) {
    while(!feof($file)) {
        $line = fgets($file);
        if( !empty($line) && strpos($line, 'add_property')){
            $data[] = $line;            
        }
    }
}

$tmp = [];

foreach( $data as $line ){
    $str_pos = strpos($line, '{"O');
    
    $date = substr($line, 1, 19);
    
    $str_pos2 = strrpos($line, ']}');
    $str_pos2 =  $str_pos2+2; 
    
    $json = substr($line, $str_pos, ($str_pos2-$str_pos) );
    $json = json_decode($json, true);
    
    $tmp[] = ["property_code"=>$json['Output']['data']['property_code'], "platform"=>$json['header']['HTTP_USER_AGENT'][0], "added_on"=>$date];
}

foreach( $tmp as $v ){
    $sql = "UPDATE property_details set created_on = '".$v['added_on']."',platform_str='".$v['platform']."' WHERE property_code = '".$v['property_code']."';";
    echo $sql."\n";
}